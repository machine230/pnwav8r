<!DOCTYPE html>
<html lang="en">
<<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N7798E Weight & Balance Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f7fa; color: #333; margin: 0; }
        nav { background-color: #2b6cb0; padding: 10px 20px; }
        nav a { color: #fff; text-decoration: none; margin-right: 20px; font-weight: bold; }
        .container { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2b6cb0; }
        label { display: inline-block; width: 220px; margin-bottom: 10px; }
        input { width: 80px; padding: 5px; margin-bottom: 10px; }
        button { padding: 10px 20px; background-color: #2b6cb0; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #1a4e8a; }
        table { border-collapse: collapse; margin-top: 20px; width: auto; }
        th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
        th { background-color: #2b6cb0; color: #fff; }
        canvas { display: block; margin: 20px auto; background: #fff; border: 1px solid #ccc; }
        .small-text { font-size: 12px; color: #555; text-align: center; margin-top: 20px; }
        @media (max-width: 768px) {
            .container { width: 95%; padding: 10px; margin: auto; }
            nav a { display: block; margin: 10px 0; }
            label { width: 100%; display: block; margin-bottom: 5px; }
            input { width: 100%; padding: 8px; }
            button { width: 100%; margin-bottom: 10px; }
            table { width: 100%; font-size: 14px; }
            canvas { width: 100% !important; height: auto !important; }
        }
    </style>
</head>
>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N7798E Weight & Balance Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f5f7fa; color: #333; margin: 0; }
        nav { background-color: #2b6cb0; padding: 10px 20px; }
        nav a { color: #fff; text-decoration: none; margin-right: 20px; font-weight: bold; }
        .container { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2b6cb0; }
        label { display: inline-block; width: 220px; margin-bottom: 10px; }
        input { width: 80px; padding: 5px; margin-bottom: 10px; }
        button { padding: 10px 20px; background-color: #2b6cb0; color: #fff; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #1a4e8a; }
        table { border-collapse: collapse; margin-top: 20px; width: auto; }
        th, td { border: 1px solid #ccc; padding: 5px 10px; text-align: center; }
        th { background-color: #2b6cb0; color: #fff; }
        canvas { display: block; margin: 20px auto; background: #fff; border: 1px solid #ccc; }
        .small-text { font-size: 12px; color: #555; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">METAR Lookup</a>
        <a href="wb.html">Weight & Balance</a>
    </nav>

    <div class="container">
        <h1>N7798E Weight & Balance Calculator</h1>
        <p style="text-align:center; font-size: 16px; margin-top: -10px;">
            Tail Number: <strong>N7798E</strong> - Cessna 150 (<a href="https://link-to-your-poh.pdf" target="_blank" style="color:#2b6cb0; text-decoration:underline;">View POH</a>)
        </p>

        <label>Pilot Weight (lbs):</label>
        <input type="number" id="pilotWeight" value="160"><br>
        <label>Passenger Weight (lbs):</label>
        <input type="number" id="passengerWeight" value="160"><br>
        <label>Baggage Weight (lbs):</label>
        <input type="number" id="baggage" value="10" max="29"><br>
        <label>Fuel (Gallons usable):</label>
        <input type="number" id="fuel" value="20" max="22.5"><br><br>

        <button onclick="calculateWB()">Calculate</button>

        <canvas id="cgCanvas" width="600" height="400"></canvas>

        <div id="breakdown"></div>
        <div id="advisoryTable"></div>

        <h3>Basic Weights (lbs):</h3>
        <table>
            <tr><th>Empty Weight</th><th>MGTW</th><th>MRW</th><th>MLW</th></tr>
            <tr><td>1041.5</td><td>1500</td><td>1500</td><td>1500</td></tr>
        </table>

        <h3>Normal category CG Limits (lbs, in):</h3>
        <table>
            <tr><th>Up to</th><th>Fwd Limit</th><th>Aft Limit</th></tr>
            <tr><td>1100</td><td>32.20</td><td>37.30</td></tr>
            <tr><td>1250</td><td>32.20</td><td>36.50</td></tr>
            <tr><td>1500</td><td>33.40</td><td>36.50</td></tr>
        </table>

        <p class="small-text">
            NB: Always verify with the latest POH. This calculator is for preflight estimation only.
        </p>
    </div>

    <script>
        const EMPTY_WEIGHT = 1041.5;
        const EMPTY_CG = 31.78;
        const MAX_GROSS_WEIGHT = 1500;
        const CG_FORWARD_LIMITS = [
            { weight: 1100, cg: 32.20 },
            { weight: 1250, cg: 32.20 },
            { weight: 1500, cg: 33.40 }
        ];
        const CG_AFT_LIMIT = 36.50;

        function interpolateForwardCGLimit(weight) {
            for (let i = 0; i < CG_FORWARD_LIMITS.length - 1; i++) {
                const current = CG_FORWARD_LIMITS[i];
                const next = CG_FORWARD_LIMITS[i + 1];
                if (weight <= next.weight) {
                    const ratio = (weight - current.weight) / (next.weight - current.weight);
                    return current.cg + ratio * (next.cg - current.cg);
                }
            }
            return CG_FORWARD_LIMITS[CG_FORWARD_LIMITS.length - 1].cg;
        }

        function calculateWB() {
            const pilotWeight = parseFloat(document.getElementById('pilotWeight').value);
            const passengerWeight = parseFloat(document.getElementById('passengerWeight').value);
            const baggageWeight = Math.min(parseFloat(document.getElementById('baggage').value), 29);
            const fuelGallons = Math.min(parseFloat(document.getElementById('fuel').value), 22.5);
            const fuelWeight = fuelGallons * 6;

            const emptyMoment = EMPTY_WEIGHT * EMPTY_CG;
            const frontSeatsMoment = (pilotWeight + passengerWeight) * 39.11;
            const baggageMoment = baggageWeight * 65.51;
            const fuelMoment = fuelWeight * 42.22;

            const totalWeight = EMPTY_WEIGHT + pilotWeight + passengerWeight + baggageWeight + fuelWeight;
            const totalMoment = emptyMoment + frontSeatsMoment + baggageMoment + fuelMoment;
            const cgPosition = totalMoment / totalWeight;

            const forwardLimit = interpolateForwardCGLimit(totalWeight);
            const cgStatus = (cgPosition < forwardLimit || cgPosition > CG_AFT_LIMIT) ? 'Out of Limits' : 'Within Limits';
            const weightStatus = (totalWeight > MAX_GROSS_WEIGHT) ? 'Over Limit' : 'Within Limit';

            document.getElementById('breakdown').innerHTML = `
                <table>
                    <tr><th>Station</th><th>Weight (lbs)</th><th>Arm (in)</th><th>Moment (in-lbs)</th></tr>
                    <tr><td>Empty Weight</td><td>${EMPTY_WEIGHT}</td><td>${EMPTY_CG}</td><td>${emptyMoment.toFixed(1)}</td></tr>
                    <tr><td>Front Seats</td><td>${pilotWeight + passengerWeight}</td><td>39.11</td><td>${frontSeatsMoment.toFixed(1)}</td></tr>
                    <tr><td>Baggage</td><td>${baggageWeight}</td><td>65.51</td><td>${baggageMoment.toFixed(1)}</td></tr>
                    <tr><td>Fuel</td><td>${fuelWeight}</td><td>42.22</td><td>${fuelMoment.toFixed(1)}</td></tr>
                    <tr><th>Total</th><th>${totalWeight.toFixed(1)}</th><th>-</th><th>${totalMoment.toFixed(1)}</th></tr>
                    <tr><th>CG ARM</th><th colspan="3">${cgPosition.toFixed(2)} in</th></tr>
                </table>`;

            document.getElementById('advisoryTable').innerHTML = `
                <table>
                    <tr><th>Condition</th><th>Status</th></tr>
                    <tr><td>Total Weight</td><td class="${weightStatus === 'Over Limit' ? 'warning' : 'ok'}">${weightStatus}</td></tr>
                    <tr><td>CG Position (${forwardLimit.toFixed(2)} - ${CG_AFT_LIMIT})</td><td class="${cgStatus === 'Out of Limits' ? 'warning' : 'ok'}">${cgStatus}</td></tr>
                </table>`;

            drawCGGraph(cgPosition, totalWeight);
        }

        function drawCGGraph(cg, weight) {
            const canvas = document.getElementById('cgCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const xScale = 50;
            const yScale = 0.5;
            const xOffset = 50;
            const yOffset = 350;

            ctx.fillStyle = '#e0e0e0';
            ctx.beginPath();
            ctx.moveTo(xOffset + (32.20 - 30) * xScale, yOffset - (1100 - 1100) * yScale);
            ctx.lineTo(xOffset + (32.20 - 30) * xScale, yOffset - (1250 - 1100) * yScale);
            ctx.lineTo(xOffset + (33.40 - 30) * xScale, yOffset - (1500 - 1100) * yScale);
            ctx.lineTo(xOffset + (36.50 - 30) * xScale, yOffset - (1500 - 1100) * yScale);
            ctx.lineTo(xOffset + (36.50 - 30) * xScale, yOffset - (1250 - 1100) * yScale);
            ctx.lineTo(xOffset + (37.30 - 30) * xScale, yOffset - (1100 - 1100) * yScale);
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            ctx.arc(xOffset + (cg - 30) * xScale, yOffset - (weight - 1100) * yScale, 6, 0, 2 * Math.PI);
            ctx.fillStyle = 'red';
            ctx.fill();
        }

        window.onload = function() {
            calculateWB();
        }
    </script>
</body>
</html>
